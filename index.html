<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TRATAMENTO PLANILHA ITENS | PERFECTA</title>
  <!-- Biblioteca PapaParse para ler CSV -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
  <!-- Fonte Montserrat (mais moderna) -->
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <!-- Ícones do Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --primary-color: #e74c3c;
      --primary-dark: #c0392b;
      --secondary-color: #2c3e50;
      --light-gray: #f8f9fa;
      --medium-gray: #e9ecef;
      --dark-gray: #343a40;
      --text-color: #495057;
      --white: #ffffff;
      --border-radius: 8px;
      --box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
      --transition: all 0.3s ease;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Montserrat', sans-serif;
      background-color: var(--light-gray);
      color: var(--text-color);
      line-height: 1.6;
      padding: 0;
    }

    /* Layout Container */
    .app-container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 20px;
    }

    /* Header Moderno */
    .main-header {
      background-color: var(--white);
      padding: 15px 0;
      box-shadow: var(--box-shadow);
      margin-bottom: 30px;
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .header-content {
      display: flex;
      align-items: center;
      justify-content: space-between;
      max-width: 1400px;
      margin: 0 auto;
      padding: 0 20px;
    }

    .main-header h1 {
      font-size: 1.5rem;
      font-weight: 600;
      color: var(--secondary-color);
      margin: 0;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .logo {
      height: 40px;
      transition: var(--transition);
    }

    .logo:hover {
      transform: scale(1.05);
    }

    /* Painel de Controle */
    .control-panel {
      background-color: var(--white);
      border-radius: var(--border-radius);
      box-shadow: var(--box-shadow);
      padding: 20px;
      margin-bottom: 30px;
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      align-items: center;
    }

    .file-upload {
      position: relative;
      flex: 1 1 300px;
    }

    .file-upload input[type="file"] {
      position: absolute;
      left: 0;
      top: 0;
      opacity: 0;
      width: 100%;
      height: 100%;
      cursor: pointer;
    }

    .file-upload-label {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      background-color: var(--primary-color);
      color: var(--white);
      padding: 12px 20px;
      border-radius: var(--border-radius);
      cursor: pointer;
      transition: var(--transition);
      font-weight: 500;
    }

    .file-upload-label:hover {
      background-color: var(--primary-dark);
    }

    .btn {
      background-color: var(--secondary-color);
      color: var(--white);
      border: none;
      padding: 12px 20px;
      border-radius: var(--border-radius);
      cursor: pointer;
      transition: var(--transition);
      font-weight: 500;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      font-size: 0.9rem;
    }

    .btn:hover {
      background-color: var(--dark-gray);
      transform: translateY(-2px);
    }

    .btn-primary {
      background-color: var(--primary-color);
    }

    .btn-primary:hover {
      background-color: var(--primary-dark);
    }

    .btn-group {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
    }

    .color-input-group {
      display: flex;
      align-items: center;
      gap: 10px;
      flex: 1 1 250px;
    }

    .color-input {
      padding: 12px 15px;
      border: 1px solid var(--medium-gray);
      border-radius: var(--border-radius);
      flex: 1;
      transition: var(--transition);
    }

    .color-input:focus {
      outline: none;
      border-color: var(--primary-color);
      box-shadow: 0 0 0 3px rgba(231, 76, 60, 0.2);
    }

    /* Tabelas */
    .table-container {
      background-color: var(--white);
      border-radius: var(--border-radius);
      box-shadow: var(--box-shadow);
      padding: 20px;
      margin-bottom: 30px;
      overflow-x: auto;
    }

    .table-title {
      font-size: 1.2rem;
      font-weight: 600;
      color: var(--secondary-color);
      margin-bottom: 15px;
      text-align: center;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
      min-width: 600px;
    }

    th, td {
      padding: 12px 15px;
      text-align: left;
      border-bottom: 1px solid var(--medium-gray);
    }

    th {
      background-color: var(--secondary-color);
      color: var(--white);
      font-weight: 500;
      text-transform: uppercase;
      font-size: 0.8rem;
      letter-spacing: 0.5px;
    }

    tr:hover {
      background-color: rgba(231, 76, 60, 0.05);
    }

    /* Resumos */
    .summary-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
      gap: 30px;
      margin-bottom: 30px;
    }

    .summary-box {
      background-color: var(--white);
      border-radius: var(--border-radius);
      box-shadow: var(--box-shadow);
      padding: 20px;
      display: flex;
      flex-direction: column;
    }

    .summary-title {
      font-size: 1.2rem;
      font-weight: 600;
      color: var(--secondary-color);
      margin-bottom: 15px;
      text-align: center;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .summary-table-container {
      margin-bottom: 20px;
      overflow-x: auto;
    }

    .summary-table {
      width: 100%;
      min-width: 300px;
    }

    /* Responsividade */
    @media (max-width: 768px) {
      .header-content {
        flex-direction: column;
        gap: 15px;
      }

      .control-panel {
        flex-direction: column;
        align-items: stretch;
      }

      .btn-group {
        justify-content: center;
      }

      .summary-container {
        grid-template-columns: 1fr;
      }
    }

    @media (max-width: 480px) {
      .main-header h1 {
        font-size: 1.2rem;
      }

      .btn {
        padding: 10px 15px;
        font-size: 0.8rem;
      }

      th, td {
        padding: 8px 10px;
        font-size: 0.9rem;
      }
    }

    /* Efeitos e Utilitários */
    .pulse {
      animation: pulse 1.5s infinite;
    }

    @keyframes pulse {
      0% { box-shadow: 0 0 0 0 rgba(231, 76, 60, 0.4); }
      70% { box-shadow: 0 0 0 10px rgba(231, 76, 60, 0); }
      100% { box-shadow: 0 0 0 0 rgba(231, 76, 60, 0); }
    }

    .text-center {
      text-align: center;
    }

    .mb-20 {
      margin-bottom: 20px;
    }
  </style>
</head>
<body>
  <!-- Cabeçalho Moderno -->
  <header class="main-header">
    <div class="header-content">
      <h1>TRATAMENTO PLANILHA DE ITENS | PERFECTA</h1>
      <img src="LOGO.png" alt="Logo Perfecta" class="logo">
    </div>
  </header>

  <!-- Container Principal -->
  <div class="app-container">
    <!-- Painel de Controle -->
    <section class="control-panel">
      <div class="file-upload">
        <label for="csvFile" class="file-upload-label">
          <i class="fas fa-file-upload"></i>
          Escolher Arquivo CSV
        </label>
        <input type="file" id="csvFile" accept=".csv,.txt">
      </div>

      <div class="btn-group">
        <button onclick="exportCSV()" class="btn">
          <i class="fas fa-file-csv"></i> Exportar CSV
        </button>
        <button onclick="exportXLS()" class="btn">
          <i class="fas fa-file-excel"></i> Exportar XLS
        </button>
        <button onclick="copyProcessedTable()" class="btn">
          <i class="fas fa-copy"></i> Copiar para Notion
        </button>
      </div>

      <div class="color-input-group">
        <label for="col9Color"><i class="fas fa-palette"></i></label>
        <input type="text" id="col9Color" class="color-input" placeholder="Digite a cor (ex: peltre)">
        <button onclick="updateCol9()" class="btn btn-primary">Atualizar</button>
      </div>
    </section>

    <!-- Tabela Processada -->
    <section class="table-container">
      <h2 class="table-title">TABELA PROCESSADA</h2>
      <div class="table-responsive">
        <table id="resultTable">
          <thead>
            <tr>
              <th>TIPO</th>
              <th>ITENS</th>
              <th>DESCRIÇÃO</th>
              <th>AMBIENTE</th>
              <th>COR</th>
              <th>PRODUTO</th>
              <th>CATEGORIA</th>
            </tr>
          </thead>
          <tbody>
            <!-- Dados serão preenchidos dinamicamente -->
          </tbody>
        </table>
      </div>
    </section>

    <!-- Resumos -->
    <section class="summary-container">
      <div class="summary-box">
        <h2 class="summary-title">TOTAL POR PRODUTO</h2>
        <div class="summary-table-container">
          <table id="summaryTable" class="summary-table">
            <thead>
              <tr>
                <th>PRODUTO</th>
                <th>QUANTIDADE</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
        <div class="btn-group">
          <button onclick="exportCSVSummary()" class="btn">
            <i class="fas fa-file-csv"></i> Exportar
          </button>
          <button onclick="exportXLSSummary()" class="btn">
            <i class="fas fa-file-excel"></i> Exportar
          </button>
          <button onclick="copySummaryTable()" class="btn">
            <i class="fas fa-copy"></i> Copiar
          </button>
        </div>
      </div>

      <div class="summary-box">
        <h2 class="summary-title">TOTAL POR CATEGORIA</h2>
        <div class="summary-table-container">
          <table id="summaryTable2" class="summary-table">
            <thead>
              <tr>
                <th>CATEGORIA</th>
                <th>QUANTIDADE</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
        <div class="btn-group">
          <button onclick="exportCSVSummary2()" class="btn">
            <i class="fas fa-file-csv"></i> Exportar
          </button>
          <button onclick="exportXLSSummary2()" class="btn">
            <i class="fas fa-file-excel"></i> Exportar
          </button>
          <button onclick="copySummaryTable2()" class="btn">
            <i class="fas fa-copy"></i> Copiar
          </button>
        </div>
      </div>
    </section>
  </div>

  <script>
    // Array com os dados processados (cada linha é um array)
    let processedData = [];
    // Variável global para guardar o último valor de cor atualizado
    let lastUpdatedColor = null;
    // Contagens para os resumos
    const summaryCounts = {};   // Para PRODUTO (utilizando getCodigo)
    const summaryCounts2 = {};  // Para CATEGORIA (utilizando getCodigo2)
    let totalItens = 0;         // Soma dos valores da 8ª coluna do CSV

    // Função para determinar o PRODUTO (baseada na DESCRIÇÃO – COLUNA 4)
    function getCodigo(texto) {
      const str = texto.toLowerCase();
      if (str.includes("fixo")) {
        return "Fixo";
      } else if (str.includes("porta de correr") && str.includes("persiana")) {
        return "PCR Integrada";
      } else if (str.includes("janela de correr") && str.includes("persiana")) {
        return "JCR Integrada";
      } else if (str.includes("porta de correr")) {
        return "PCR";
      } else if (str.includes("janela de correr")) {
        return "JCR";
      } else if (str.includes("persiana")) {
        return "Integrada";
      } else if (str.includes("acm")) {
        return "ACM";
      } else if (str.includes("maxim-ar") || str.includes("maxim") || str.includes("max")) {
        return "Maxim-ar";
      } else if (str.includes("porta de giro")) {
        return "PGR";
      } else if (str.includes("oscilo") || str.includes("osc") || str.includes("abt")) {
        return "Oscilo";
      } else if (str.includes("pivotante")) {
        return "Pivotante";
      } else if (str.includes("brise")) {
        return "Brise";
      } else if (str.includes("ripado")) {
        return "Ripado";
      }
      return "";
    }

    // Função para determinar a CATEGORIA (baseada nos ITENS – COLUNA 3)
    function getCodigo2(texto) {
      const str = texto.toLowerCase();
      if (str.includes("gol")) {
        return "Aluminio";
      } else if (str.includes("rip")) {
        return "Ripado";
      } else if (str.includes("brise")) {
        return "Brise";
      } else if (str.includes("acm") || str.includes("layer")) {
        return "Layer";
      }
      return "PVC";
    }

    // Leitura do arquivo CSV/TXT
    document.getElementById('csvFile').addEventListener('change', function(e) {
      const file = e.target.files[0];
      if (!file) return;
      
      // Adiciona efeito visual de carregamento
      const fileUploadLabel = document.querySelector('.file-upload-label');
      fileUploadLabel.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processando...';
      
      Papa.parse(file, {
        complete: function(results) {
          processedData = [];
          // Zera as contagens
          for (let key in summaryCounts) { delete summaryCounts[key]; }
          for (let key in summaryCounts2) { delete summaryCounts2[key]; }
          totalItens = 0;

          // Processa cada linha do CSV
          results.data.forEach(function(row) {
            if (row.length >= 8 && row[0] && !isNaN(row[7])) {
              const tipo = row[0];
              const itens = row[2];
              const descricao = row[3];
              const ambiente = row[4];
              const cor = row[5] || lastUpdatedColor || "";
              const produto = getCodigo(descricao);
              const categoria = getCodigo2(itens);
              const quantidade = parseFloat(row[7]);

              // Adiciona aos dados processados
              processedData.push([tipo, itens, descricao, ambiente, cor, produto, categoria, quantidade]);

              // Atualiza contagem para resumo por produto
              if (produto) {
                summaryCounts[produto] = (summaryCounts[produto] || 0) + quantidade;
              }

              // Atualiza contagem para resumo por categoria
              if (categoria) {
                summaryCounts2[categoria] = (summaryCounts2[categoria] || 0) + quantidade;
              }

              // Soma ao total de itens
              totalItens += quantidade;
            }
          });

          // Atualiza a tabela principal
          updateResultTable();
          // Atualiza as tabelas de resumo
          updateSummaryTables();
          
          // Restaura o botão de upload
          fileUploadLabel.innerHTML = '<i class="fas fa-check-circle"></i> Arquivo Processado';
          setTimeout(() => {
            fileUploadLabel.innerHTML = '<i class="fas fa-file-upload"></i> Escolher Arquivo CSV';
          }, 2000);
        },
        error: function(error) {
          console.error("Erro ao processar arquivo:", error);
          fileUploadLabel.innerHTML = '<i class="fas fa-exclamation-circle"></i> Erro ao Processar';
          setTimeout(() => {
            fileUploadLabel.innerHTML = '<i class="fas fa-file-upload"></i> Escolher Arquivo CSV';
          }, 2000);
        }
      });
    });

    // Atualiza a tabela principal com os dados processados
    function updateResultTable() {
      const tbody = document.querySelector('#resultTable tbody');
      tbody.innerHTML = '';

      processedData.forEach(function(row) {
        const tr = document.createElement('tr');
        
        // Adiciona as células com os dados processados
        for (let i = 0; i < 7; i++) { // Apenas as 7 primeiras colunas (a 8ª é a quantidade)
          const td = document.createElement('td');
          td.textContent = row[i] || '';
          tr.appendChild(td);
        }
        
        tbody.appendChild(tr);
      });
    }

    // Atualiza as tabelas de resumo
    function updateSummaryTables() {
      updateSummaryTable('summaryTable', summaryCounts);
      updateSummaryTable('summaryTable2', summaryCounts2);
    }

    // Atualiza uma tabela de resumo específica
    function updateSummaryTable(tableId, data) {
      const tbody = document.querySelector(`#${tableId} tbody`);
      tbody.innerHTML = '';

      // Ordena os itens por quantidade (decrescente)
      const sortedItems = Object.entries(data).sort((a, b) => b[1] - a[1]);

      sortedItems.forEach(function([item, quantidade]) {
        const tr = document.createElement('tr');
        
        const tdItem = document.createElement('td');
        tdItem.textContent = item;
        
        const tdQuantidade = document.createElement('td');
        tdQuantidade.textContent = quantidade;
        
        tr.appendChild(tdItem);
        tr.appendChild(tdQuantidade);
        tbody.appendChild(tr);
      });

      // Adiciona linha de total se for a tabela de produtos
      if (tableId === 'summaryTable') {
        const trTotal = document.createElement('tr');
        trTotal.style.fontWeight = 'bold';
        
        const tdTotalLabel = document.createElement('td');
        tdTotalLabel.textContent = 'TOTAL';
        
        const tdTotalValue = document.createElement('td');
        tdTotalValue.textContent = totalItens;
        
        trTotal.appendChild(tdTotalLabel);
        trTotal.appendChild(tdTotalValue);
        tbody.appendChild(trTotal);
      }
    }

    // Atualiza a coluna de cor (COLUNA 9) com o valor digitado
    function updateCol9() {
      const colorInput = document.getElementById('col9Color');
      const newColor = colorInput.value.trim();
      
      if (!newColor) {
        alert('Por favor, digite um valor para a cor.');
        return;
      }
      
      lastUpdatedColor = newColor;
      
      // Atualiza a cor em todos os dados processados onde a cor estava vazia
      processedData.forEach(function(row) {
        if (!row[4] || row[4] === lastUpdatedColor) {
          row[4] = newColor;
        }
      });
      
      // Atualiza a exibição da tabela
      updateResultTable();
      
      // Efeito visual de confirmação
      colorInput.style.borderColor = '#e74c3c';
      setTimeout(() => {
        colorInput.style.borderColor = '';
      }, 1000);
    }

    // Exporta a tabela processada para CSV
    function exportCSV() {
      if (processedData.length === 0) {
        alert('Não há dados para exportar.');
        return;
      }
      
      // Cria cabeçalhos
      const headers = ['TIPO', 'ITENS', 'DESCRIÇÃO', 'AMBIENTE', 'COR', 'PRODUTO', 'CATEGORIA', 'QUANTIDADE'];
      const data = [headers, ...processedData];
      
      const csv = Papa.unparse(data);
      downloadFile(csv, 'planilha_processada.csv', 'text/csv;charset=utf-8;');
    }

    // Exporta a tabela processada para XLS
    function exportXLS() {
      if (processedData.length === 0) {
        alert('Não há dados para exportar.');
        return;
      }
      
      // Cria cabeçalhos
      const headers = ['TIPO', 'ITENS', 'DESCRIÇÃO', 'AMBIENTE', 'COR', 'PRODUTO', 'CATEGORIA', 'QUANTIDADE'];
      const data = [headers, ...processedData];
      
      let csv = Papa.unparse(data);
      
      // Converter CSV para XLS
      let html = '<html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns="http://www.w3.org/TR/REC-html40"><head><!--[if gte mso 9]><xml><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet><x:Name>Planilha1</x:Name><x:WorksheetOptions><x:DisplayGridlines/></x:WorksheetOptions></x:ExcelWorksheet></x:ExcelWorksheets></x:ExcelWorkbook></xml><![endif]--></head><body><table>';
      
      data.forEach(function(row) {
        html += '<tr>';
        row.forEach(function(cell) {
          html += '<td>' + (cell || '') + '</td>';
        });
        html += '</tr>';
      });
      
      html += '</table></body></html>';
      
      downloadFile(html, 'planilha_processada.xls', 'application/vnd.ms-excel');
    }

    // Copia a tabela processada para área de transferência (formato para Notion)
    function copyProcessedTable() {
      if (processedData.length === 0) {
        alert('Não há dados para copiar.');
        return;
      }
      
      let text = 'TIPO\tITENS\tDESCRIÇÃO\tAMBIENTE\tCOR\tPRODUTO\tCATEGORIA\tQUANTIDADE\n';
      
      processedData.forEach(function(row) {
        text += row.join('\t') + '\n';
      });
      
      navigator.clipboard.writeText(text).then(function() {
        alert('Dados copiados para a área de transferência no formato para Notion!');
      }, function() {
        alert('Erro ao copiar para a área de transferência. Por favor, tente novamente.');
      });
    }

    // Exporta a tabela de resumo (produto) para CSV
    function exportCSVSummary() {
      exportSummaryToCSV(summaryCounts, 'resumo_produto.csv');
    }

    // Exporta a tabela de resumo (produto) para XLS
    function exportXLSSummary() {
      exportSummaryToXLS(summaryCounts, 'resumo_produto.xls');
    }

    // Copia a tabela de resumo (produto) para área de transferência (formato para Notion)
    function copySummaryTable() {
      copySummaryToClipboard(summaryCounts, 'PRODUTO');
    }

    // Exporta a tabela de resumo (categoria) para CSV
    function exportCSVSummary2() {
      exportSummaryToCSV(summaryCounts2, 'resumo_categoria.csv');
    }

    // Exporta a tabela de resumo (categoria) para XLS
    function exportXLSSummary2() {
      exportSummaryToXLS(summaryCounts2, 'resumo_categoria.xls');
    }

    // Copia a tabela de resumo (categoria) para área de transferência (formato para Notion)
    function copySummaryTable2() {
      copySummaryToClipboard(summaryCounts2, 'CATEGORIA');
    }

    // Função auxiliar para exportar resumo para CSV
    function exportSummaryToCSV(data, filename) {
      if (Object.keys(data).length === 0) {
        alert('Não há dados para exportar.');
        return;
      }
      
      const headers = ['ITEM', 'QUANTIDADE'];
      const rows = Object.entries(data).map(([item, quantidade]) => [item, quantidade]);
      
      // Adiciona total se for o resumo de produtos
      if (filename.includes('produto')) {
        rows.push(['TOTAL', totalItens]);
      }
      
      const csv = Papa.unparse([headers, ...rows]);
      downloadFile(csv, filename, 'text/csv;charset=utf-8;');
    }

    // Função auxiliar para exportar resumo para XLS
    function exportSummaryToXLS(data, filename) {
      if (Object.keys(data).length === 0) {
        alert('Não há dados para exportar.');
        return;
      }
      
      const headers = ['ITEM', 'QUANTIDADE'];
      const rows = Object.entries(data).map(([item, quantidade]) => [item, quantidade]);
      
      // Adiciona total se for o resumo de produtos
      if (filename.includes('produto')) {
        rows.push(['TOTAL', totalItens]);
      }
      
      let html = '<html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns="http://www.w3.org/TR/REC-html40"><head><!--[if gte mso 9]><xml><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet><x:Name>Planilha1</x:Name><x:WorksheetOptions><x:DisplayGridlines/></x:WorksheetOptions></x:ExcelWorksheet></x:ExcelWorksheets></x:ExcelWorkbook></xml><![endif]--></head><body><table>';
      
      // Adiciona cabeçalhos
      html += '<tr><th>' + headers.join('</th><th>') + '</th></tr>';
      
      // Adiciona linhas de dados
      rows.forEach(function(row) {
        html += '<tr><td>' + row.join('</td><td>') + '</td></tr>';
      });
      
      html += '</table></body></html>';
      
      downloadFile(html, filename, 'application/vnd.ms-excel');
    }

    // Função auxiliar para copiar resumo para área de transferência
    function copySummaryToClipboard(data, type) {
      if (Object.keys(data).length === 0) {
        alert('Não há dados para copiar.');
        return;
      }
      
      let text = `${type}\tQUANTIDADE\n`;
      
      Object.entries(data).forEach(([item, quantidade]) => {
        text += `${item}\t${quantidade}\n`;
      });
      
      // Adiciona total se for o resumo de produtos
      if (type === 'PRODUTO') {
        text += `TOTAL\t${totalItens}\n`;
      }
      
      navigator.clipboard.writeText(text).then(function() {
        alert(`Resumo de ${type.toLowerCase()} copiado para a área de transferência no formato para Notion!`);
      }, function() {
        alert('Erro ao copiar para a área de transferência. Por favor, tente novamente.');
      });
    }

    // Função auxiliar para download de arquivo
    function downloadFile(content, filename, mimeType) {
      const blob = new Blob([content], { type: mimeType });
      const url = URL.createObjectURL(blob);
      
      const a = document.createElement('a');
      a.href = url;
      a.download = filename;
      document.body.appendChild(a);
      a.click();
      
      setTimeout(() => {
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
      }, 100);
    }
  </script>
</body>
</html>
